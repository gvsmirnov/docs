<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8" />

    <title>Java Concurrency Under The Hood</title>

    <link href="css/impress.css" rel="stylesheet"/>
    <link href="css/prettify.css" rel="stylesheet"/>
    <link href="css/animation.css" rel="stylesheet"/>
    <link href="css/bootstrap.min.css" rel="stylesheet"/>

    <script src="js/jquery.min.js"></script>
    <script src="js/jmpress.impress.js"></script>
    <script src="js/google-code-prettify/prettify.js"></script>
    <script src="js/bootstrap.min.js"></script>

</head>
<body>

    <div class="alert alert-warning navbar-fixed-top text-center">
        Under construction. Unless you have been explicitly given this link, you should probably go away right now.
        Also, don't share this link, please.
    </div>

    <div id="impress">

        <div class="step step-title" data-y="-800">
            <div class="jumbotron text-center">
                <h1>
                    Java Concurrency:
                    Under The Hood
                </h1>
                <p>#volatile #membar #dragons #openjdk #mesi</p>
                <p>#jmm #store #load #omg #internals</p>
                <p>#cachecoherency</p>
                <p>#jugru</p>

                <footer>
                    <h2>Gleb Smirnov</h2>
                    <h3>me<span class="text-info">@gvsmirnov</span>.ru</h3>
                </footer>

            </div>
        </div>

        <div class="step step-slide">
            <h1>Leaky Abstractions</h1>

            <ul>
                <li data-jmpress="fade">
                    Each abstraction level obscures <span class="text-muted"> implementation details</span>
                </li>
                <li data-jmpress="fade">
                    Things that happen on <b>lower levels</b>
                    affect <b>high-level</b> behavior
                </li>
                <li data-jmpress="fade">
                    Some phenomena <b>cannot be explained</b> using high-level terms
                </li>
                <li data-jmpress="fade">
                    In other words, abstractions leak
                </li>
            </ul>
        </div>

        <div class="step spoiler">
            <div class="text-center">
                <img class="graph scale-to-fit-h" src="img/go-deeper.jpg"/>
            </div>
        </div>

        <div class="step step-slide" data-x="1300">
            <h1>Just Another Brick In The Wall</h1>

            <ul>
                <li data-jmpress="fade">
                    Accessing RAM can take <b>hundreds of nanoseconds</b>
                </li>
                <li data-jmpress="fade">
                    Basic instructions are several <b>orders of magnitude</b> faster
                </li>
                <li data-jmpress="fade">
                    Don't want to stall the CPU much
                </li>
                <li data-jmpress="fade">
                    Better keep the most frequently used data at hand
                </li>
            </ul>
        </div>

        <div class="step step-slide spoiler" data-x="1300">
            <div class="jumbotron text-center">
                <h1 class="margin-a-lot"><span class="text-success text-giant">Yay Caches!</span></h1>
            </div>
        </div>

        <div class="step step-slide" data-x="2600">
            <h1>Moore's Law</h1>

            <blockquote>
                <!-- http://www.intel.com/content/www/us/en/history/museum-gordon-moore-law.html -->
                <p>
                    The number of transistors incorporated in a chip
                    will approximately double every 24 months
                </p>
                <footer> &mdash; Gordon Earle Moore, 1964</footer>
            </blockquote>

        </div>

        <div class="step step-slide" data-x="3900">
            <div class="text-center">
                <img class="graph" src="img/moores-law.jpg"/>
            </div>
        </div>

        <div class="step step-slide" data-x="5200">
            <div class="text-center">
                <!-- http://queue.acm.org/detail.cfm?id=2181798 -->
                <img class="graph scale-to-fit-h" src="img/horowitz_fig7.png"/>
            </div>
        </div>

        <div class="step step-slide" data-x="6500">
            <h1 class="text-smaller">One Does Not Simply Increase Clock Rate</h1>

            <ul>
                <li data-jmpress="fade">
                    Smaller transistors &rArr; more resistance &rArr; smaller frequency
                </li>
                <li data-jmpress="fade">
                    Less power consumption &rArr; smaller frequency
                </li>
                <li data-jmpress="fade">
                    We still want the performance to double
                </li>
                <li data-jmpress="fade">
                    Have "spare" transistors
                </li>
            </ul>
        </div>

        <div class="step step-slide spoiler" data-x="6500">
            <div class="jumbotron text-center">
                <h1 class="margin-a-lot"><span class="text-success text-giant">Yay Multi-Core!</span></h1>
            </div>
        </div>

        <div class="step step-slide" data-y="800">
            <h1>Parallelize And Conquer</h1>

            <ul>
                <li data-jmpress="fade">
                    We can execute <b>more programs</b> concurrently
                </li>
                <li data-jmpress="fade">
                    Problems can be <b>split</b> into parallelly-executed parts
                </li>
                <li data-jmpress="fade">
                    But these parts may have some <b>shared state</b>
                </li>
            </ul>
        </div>

        <div class="step step-slide" data-y="800" data-x="1300">
            <h1>Cache Coherency</h1>

            <blockquote>
                <p>
                    How would processor <b>A</b> know that processor <b>B</b> had modified some value,
                    if <b>A</b> had cached it some time ago?
                </p>
                <footer> &mdash; A Dangerously Curious Dude</footer>
            </blockquote>
        </div>

        <div class="step spoiler" data-y="800" data-x="1300">
            <div class="text-center">
                <!-- http://explosm.net/comics/2334/ -->
                <img class="graph scale-to-fit-h" src="img/comicsplittingtheatom1.png"/>
            </div>
        </div>

        <div class="step step-slide" data-y="800" data-x="2600">
            <h1>Cache Coherency Protocols</h1>

            <ul>
                <li data-jmpress="fade">
                    The processors must maintain a <b>consistent</b> view of the world
                </li>
                <li data-jmpress="fade">
                    Always using <b>main memory</b> would ruin performance
                </li>
                <li data-jmpress="fade">
                    The processors need to <b>communicate</b> with each other
                </li>
                <li data-jmpress="fade">
                    Various communication <b>protocols</b> are possible
                </li>
            </ul>
        </div>

        <div class="step step-slide" data-y="800" data-x="3900">
            <h1>MESI <span class="text-muted">(Just An Example, Mind You)</span></h1>

            <p data-jmpress="fade">
                Each cache entry can have one of the following states:
            </p>

            <ul>
                <li data-jmpress="fade">
                    <b>I</b>nvalid: this cache does not contain the entry
                </li>
                <li data-jmpress="fade">
                    <b>E</b>xclusive: the entry resides in this cache only
                </li>
                <li data-jmpress="fade">
                    <b>M</b>odified: this processor has modified the entry
                </li>
                <li data-jmpress="fade">
                    <b>S</b>hared: more than one cache contains the entry
                </li>
            </ul>
        </div>

        <div class="step step-slide" data-y="800" data-x="5200">
            <h1>Store Buffers</h1>

            <ul>
                <li data-jmpress="fade">
                    When one processor wants to write something, it tells
                    the other processors to <b>invalidate</b> their copy of it
                </li>
                <li data-jmpress="fade">
                    But it may take a while to receive all the <b>acknowledgements</b>
                </li>
                <li data-jmpress="fade">
                    So, the processor <b>buffers</b> the write, and goes on executing stuff
                </li>
                <li data-jmpress="fade">
                    Only when all the <b>acknowledgements</b> arrive, the write finally gets executed
                </li>
            </ul>
        </div>

        <div class="step nested-steps" data-y="800" data-x="6500">
            <div class="row">
                <div class="col-md-6">
<pre class="prettyprint lang-java">
void executedOnCpu0() {
    value = 10;
    finished = true;
}
</pre>
                </div>
                <div class="col-md-6">
<pre class="prettyprint lang-java">
void executedOnCpu1() {
    while(!finished);
    assert value == 10;
}
</pre>
                </div>
            </div>

            <div class="step visit-me" data-y="150">
                <div class="row">
                    <div class="col-md-12 text-center">
                        <h1>
                            What could <i>possibly</i> go wrong?
                        </h1>
                    </div>
                </div>
            </div>

            <div class="step visit-me" data-y="250">
                <div class="row">
                    <div class="col-md-6">
<pre class="prettyprint lang-java">
finished: Exclusive
value: Invalid
</pre>
                    </div>
                    <div class="col-md-6">
<pre class="prettyprint lang-java">
finished: Invalid
value: Exclusive
</pre>
                    </div>
                </div>
            </div>

            <div class="step visit-me" data-y="350">
                <div class="row">
                    <div class="col-md-6 col-md-offset-6">
<pre class="prettyprint lang-java">
while(!finished);
&larr; read(finished)
</pre>
                    </div>
                </div>
            </div>

            <div class="step visit-me" data-y="450">
                <div class="row">
                    <div class="col-md-6">
<pre class="prettyprint lang-java">
value = 10;
- store_buffer(value)
&larr; read_invalidate(value)
</pre>
                    </div>
                </div>
            </div>

            <div class="step visit-me" data-y="600">
                <div class="row">
                    <div class="col-md-6">
<pre class="prettyprint lang-java">
finished = true;
- finished: Modified

&rarr; read(finished)
&larr; read_response(finished, true)
- finished: Shared
</pre>
                    </div>
                </div>
            </div>
        </div>

        <div class="step step-slide" id="overview"data-x="3000" data-y="1500" data-scale="10"></div>
    </div>

    <script type="text/javascript">
        $(function() {
            $('#impress').jmpress({
                "mouse": { clickSelects: false },
                "beforeChange": function(element, eventData) {
                    element = $(element);
                    if(element.is('tr') || element.hasClass("visit-me")) {
                        element.addClass('visited'); // code should not be hidden after visiting
                    }
                }
            });
        });

        !function ($) {
            $(function(){
                window.prettyPrint && prettyPrint()
            })
        }(window.jQuery)
    </script>
</body>
</html>