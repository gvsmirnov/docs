<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8" />

    <title>Тайны — в наших головах, а не в JVM</title>

    <link href="css/impress.css" rel="stylesheet"/>
    <link href="css/prettify.css" rel="stylesheet"/>
    <link href="css/animation.css" rel="stylesheet"/>
    <link href="css/bootstrap.min.css" rel="stylesheet"/>
    <link href="css/whhg.css" rel="stylesheet"/>
    <link href="css/fonts.css" rel="stylesheet"/>

    <script src="js/jquery.min.js"></script>
    <script src="js/jmpress.impress.js"></script>
    <script src="js/google-code-prettify/prettify.js"></script>
    <script src="js/bootstrap.min.js"></script>
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand">
                JPoint 2015
            </a>

            <p class="navbar-text">
                Тайны — в наших головах, а не в JVM <span class="text-muted">by</span> <span class="text-info">@gvsmirnov</span>
            </p>


        </div>
        <div class="navbar-right">
            <a class="navbar-brand">
                Слайд <span id="current-slide-number">#</span>/<span id="total-slides">#</span>
            </a>
        </div>
    </div>
</nav>


<div id="laser"></div>


<div id="impress">

<div class="step step-title mystery" data-y="-800">
    <div class="jumbotron text-center">
        <div class="title">
            <h1>
                <span class="well well-sm">Тайны — в наших головах</span>
            </h1>
            <h2>
                <span class="well well-sm">(а не в JVM)</span>
            </h2>
        </div>

        <p><span class="well well-sm">#openjdk #mystery #hotspot</span></p>
        <p><span class="well well-sm">#jpoint #jugru</span></p>

        <footer>
            <h2><span class="well well-sm">Gleb Smirnov, Plumbr</span></h2>
            <h3><span class="well well-sm">me<span class="text-info">@gvsmirnov</span>.ru</span></h3>
        </footer>

    </div>
</div>

<!-- INTRO -->

<div class="step step-slide">
    <div class="text-v-center text-center text-giant">
        <h1><img src="img/openjdk.png"/>
            <br/><span data-jmpress="fade">&approx; <strong>5.5M</strong> строк </span>
            <br/><span data-jmpress="fade"><strong>сотни тысяч</strong> человеко-часов</span>
        </h1>

        <!-- http://openjdk.java.net/groups/hotspot/ -->
        <!-- https://www.openhub.net/p/openjdk/analyses/latest/languages_summary -->
    </div>
</div>

<div class="step step-slide" data-x="1300">
    <h1>Большая и сложная система</h1>
    <ul>
        <li data-jmpress="fade">Один человек не может знать о JVM всё</li>
        <li data-jmpress="fade">Абстракции будут протекать</li>
        <li data-jmpress="fade">Будут возникать неожиданные ситуации</li>
    </ul>
</div>

<div class="step step-slide" data-x="2600">
    <div class="text-center">
        <img class="graph scale-to-fit-h" src="img/trollface.png"/>
    </div>
</div>

<div class="step step-slide" data-x="3900">
    <div class="text-center">
        <img class="graph scale-to-fit-h" src="img/duckduckgo.png"/>
    </div>
</div>

<div class="step step-slide spoiler" data-x="3900">
    <div class="text-center">
        <img class="graph scale-to-fit-h" src="img/duckduckgo-2.png"/>
    </div>
</div>

<div class="step step-slide" data-x="5200">
    <div class="text-center">
        <img class="graph" src="img/stackoverflow.png"/>
    </div>
</div>

<div class="step step-slide spoiler" data-x="5200">
    <div class="text-center">
        <img class="graph" src="img/stackoverflow-2.png"/>
    </div>
</div>

<div class="step step-slide" data-x="6500">
    <div class="text-center">
        <img class="graph" src="img/twitter.png"/>
    </div>
</div>

<div class="step step-slide spoiler" data-x="6500">
    <div class="text-center">
        <img class="graph" src="img/twitter-2.png"/>
    </div>
</div>

<!-- INTRO ENDS -->

<!-- GC CAUSES -->

<div class="step step-slide" data-y="900">

<pre class="console prettyprint">
$ jstat -gccause [...]

<span class="nocode">Timestamp     LGCC                                       GCC
1.6           Last ditch collection                    No GC
1.7           <span class="text-danger">No GC</span>                    Last ditch collection
1.8           <span class="text-danger">No GC</span>                    Last ditch collection
1.9           <span class="text-danger">No GC</span>                    Last ditch collection
2.0           <span class="text-danger">No GC</span>                    Last ditch collection</span>
</pre>

</div>

<div class="step step-slide" data-y="900" data-x="1300">
    <div class="text-center">
        <img class="graph" src="img/joker.png"/>
        <h1><span class="well">LIVE DEMO TIME!</span></h1>
    </div>
</div>

<!-- GC CAUSES END -->

<!-- OUTTAKES -->

<div class="step step-slide" data-y="1800">
    <h1>Структура Папок Hotspot</h1>
<pre class="console prettyprint" data-jmpress="fade">
<span class="nocode">hotspot/src/
<span data-jmpress="fade">├── cpu <span class="text-info"># CPU specific</span>
│   └── [x86, sparc, ...]</span>
<span data-jmpress="fade">├── os <span class="text-info"># OS specific</span>
│   └── [bsd, linux, windows, ...]</span>
<span data-jmpress="fade">├── os_cpu <span class="text-info"># OS and CPU specific</span>
│   └── [bsd_zero, linux_sparc, windows_x86, ...]</span>
<span data-jmpress="fade">└── share
    ├── tools <span class="text-info"># Stuff you probably won't need</span>
    └── vm <span class="text-info"># Most of the interesting stuff</span></span></span>
</pre>
</div>

<div class="step step-slide" data-y="1800" data-x="1300">
<pre class="console prettyprint">
<span class="nocode">hotspot/src/share/vm
<span data-jmpress="fade">├── c1 <span class="text-info"># Client compiler</span></span>
<span data-jmpress="fade">├── classfile <span class="text-info"># Class loading, verification, representation, ...</span></span>
<span data-jmpress="fade">├── code <span class="text-info"># Machine code management</span></span>
<span data-jmpress="fade">├── compiler <span class="text-info"># Things common for the compilers</span></span>
<span data-jmpress="fade">├── gc_* <span class="text-info"># Garbage Collection</span></span>
<span data-jmpress="fade">├── interpreter <span class="text-info"># Interpreter for experiments</span></span>
<span data-jmpress="fade">├── memory <span class="text-info"># Base stuff for memory, also the Universe lives here</span></span>
<span data-jmpress="fade">├── oops <span class="text-info"># Ordinary Object PointerS</span></span>
<span data-jmpress="fade">├── opto <span class="text-info"># Server compiler</span></span>
<span data-jmpress="fade">├── prims <span class="text-info"># Unsafe, JNI, JVMTI, lots of stuff</span></span>
<span data-jmpress="fade">├── runtime <span class="text-info"># VM runtime, threading, perf data, LOTS of stuff</span></span>
<span data-jmpress="fade">└── [...]</span></span>
</pre>
</div>

<div class="step step-slide" data-x="2600" data-y="1800">
    <h1>Use <code>grep</code>, Luke!</h1>

    <ul>
        <li data-jmpress="fade">Рекурсивный поиск: <code>grep -r</code></li>
        <li data-jmpress="fade">Показать контекст: <code>grep -C 3</code></li>
        <li data-jmpress="fade">Показать номера строк: <code>grep -n</code></li>
    </ul>
</div>

<div class="step step-slide" data-x="3900" data-y="1800">
    <h1>Use NetBeans, Luke!</h1>

<pre class="prettyprint console">
jdk9/common/nb_native/nbproject/
</pre>
    <div class="well well-lg" data-jmpress="fade">
        <ul>
            <li>Find Usages</li>
            <li data-jmpress="fade">Подсветка синтаксиса</li>
            <li data-jmpress="fade">Обработка макросов</li>
            <li data-jmpress="fade">Всё работает<sup>*</sup> прямо из коробки</li>
        </ul>
    </div>
</div>

<div class="step step-slide" data-x="5200" data-y="1800">
    <h1>Баги Могли Уже Исправить</h1>

<pre class="prettyprint console" data-jmpress="fade">
<span class="nocode">$ hg grep -f --all '::_no_gc'
<span class="text-muted">[...]</span>
vmGCOperations.cpp:<span class="text-info text-highlighted">2097</span>:+:  assert(((_gc_cause != GCCause::_no_gc)
</span></pre>

<pre class="prettyprint console" data-jmpress="fade">
<span class="nocode">$ hg log --rev <span class="text-info">2097</span>
<span class="text-muted">[...]</span>
summary:     <span class="text-info text-highlighted">7015169</span>: GC Cause not always set</span></pre>

</div>

<div class="step step-slide spoiler" data-x="5200" data-y="1800">
    <div class="text-center">
        <img class="graph scale-to-fit-h" src="img/jira.png"/>
    </div>
</div>

<div class="step step-slide" data-x="6500" data-y="1800">
    <h1>Как найти нужную сборку Hotspot</h1>

<pre class="prettyprint console" data-jmpress="fade">
<span class="nocode">$ hg log --rev "last(::<span class="text-info">2097</span> and tagged(), 10)"
<span class="text-muted">[...]</span>
changeset:   1993:102466e70deb
tag:         <span class="text-info text-highlighted">jdk7-b127</span>
<span class="text-muted">[...]</span>
</span></pre>

    <div class="well well-lg" data-jmpress="fade">
        <p>Не путать: <code>b127</code> и <code>u127</code> &mdash; не одно и то же</p>
    </div>

</div>

<div class="step step-slide" data-x="7800" data-y="1800">
    <h1>Сборки, Апдейты, Версии</h1>

<pre class="prettyprint console" data-jmpress="fade">
<span class="nocode">$ java -version
java version "1.7.0<span class="text-info text-highlighted">_51</span>" <span data-jmpress="fade" class="text-info"># update 51</span>
Java(TM) SE Runtime Environment (build 1.7.0_51-<span class="text-info text-highlighted">b13</span>) <span data-jmpress="fade" class="text-info"># build 13</span>
Java HotSpot(TM) 64-Bit Server VM (build 24.51-b03, mixed mode)
</span></pre>

    <div class="well well-lg" data-jmpress="fade">
        <p>У Hotspot своя версия и свои сборки. Лучше смотреть на теги.</p>
    </div>
</div>

<div class="step step-slide" data-x="9100" data-y="1800">
    <h1>Проверяйте Свои Гипотезы</h1>
    <ul>
        <li data-jmpress="fade">Изолированные эксперименты</li>
        <li data-jmpress="fade">
            Положительный контроль
            <ul>
                <li data-jmpress="fade">Другая версия JDK, где поведение изменено</li>
                <li data-jmpress="fade" class="list-unstyled">
                    <a href="http://www.oracle.com/technetwork/java/archive-139210.html">
                        http://www.oracle.com/technetwork/java/archive-139210.html
                    </a>
                </li>
                <li data-jmpress="fade">Собственноручно подхаченная JDK</li>
            </ul>
        </li>

        <li data-jmpress="fade">
            Отрицательный контроль
            <ul>
                <li data-jmpress="fade">Другая сборка, в которой целевой участок такой же</li>
                <li data-jmpress="fade">Немного другой эксперимент</li>
            </ul>
        </li>
    </ul>
</div>

<div class="step step-slide" data-x="10400" data-y="1800">
    <h1>Сообщество &mdash; Ваш Друг</h1>
    <ul>
        <li data-jmpress="fade">
            Возможно, что-то есть в списках рассылки
            <ul>
                <li data-jmpress="fade">
                    <a href="http://mail.openjdk.java.net/pipermail/hotspot-dev/">http://mail.openjdk.java.net/pipermail/hotspot-dev/</a>
                </li>
                <li data-jmpress="fade">
                    <a href="http://mail.openjdk.java.net/mailman/listinfo">http://mail.openjdk.java.net/mailman/listinfo</a>
                </li>
            </ul>
        </li>
        <li data-jmpress="fade">Не бойтесь задавать хорошие вопросы</li>
        <li data-jmpress="fade">Ваш вклад может помочь другим людям</li>
    </ul>
</div>

<!-- OUTTAKES END -->

<!-- LAST REMARKS -->


<div class="step step-slide" data-x="1300" data-y="3600">
    <h1>Дополнительные Материалы</h1>
    <ul>
        <li data-jmpress="fade">
            "Introduction to HotSpot Internals" by Paul Nauman
        </li>
        <li data-jmpress="fade">
            "Oracle JRockit: The Definitive Guide" by Marcus & Marcus
        </li>
    </ul>
</div>

<div class="step step-slide qr" data-x="2600" data-y="3600">
    <div class="text-center">
        <img class="graph" src="img/qr-joker.png"/>

        <h2>
            <a href="http://gvsmirnov.ru/docs/presentations/java-mysterious-hotspot/joker-oct-2014.html">
                goo.gl/HQx0xa
            </a>
        </h2>
    </div>
</div>

<!-- LAST REMARKS END -->

<div class="step" data-x="2600" data-y="3600" id="overview" data-scale="7"></div>

</div>
</body>

<script src="js/custom.js"></script>

<script type="text/javascript">
    !function ($) {
        $(function(){

            $('#impress').jmpress({
                "mouse": { clickSelects: false },
                "beforeChange": function(element, eventData) {
                    element = $(element);
                    if(element.hasClass("visit-me")) {
                        element.addClass('visited');
                    }

                    updateCurrentSlide(element);
                }
            });

            window.prettyPrint && prettyPrint()
            $('body').mousemove(function(e){
                $('#laser').css('left', e.clientX).css('top', e.clientY);
            });
        });
    }(window.jQuery)
</script>

</html>
